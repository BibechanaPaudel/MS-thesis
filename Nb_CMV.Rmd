---
title: "Nb_CMV"
author: "Bibechana Paudel"
date: "2025-09-28"
output: 
  html_document:
     toc: TRUE
     toc_float: TRUE
  md_document: 
    variant: gfm
---

# Library used

```{r}
#install.packages("tidyverse")
#install.packages("ggplot2")
#install.packages("agricolae")
#install.packages("tidyr")
#install.packages("ggpubr")
#install.packages("multcomp")
#install.packages("emmeans")
#install.packages("multcompView")
library(tidyverse)
library(ggplot2)
library(agricolae)
library(tidyr)
library(ggpubr)
library(multcomp)
library(emmeans)
library(multcompView)
```
# **First trial**

## Load the data
```{r}
rep1 <- read.csv("Data-obj1-New/Nb_CMV_1st_trial_New.csv", header=T)
head(rep1)  # View the first few rows
str(rep1)   # Check the structure of the data
summary(rep1) # Quick statistical summary
```

###Make the factor variable
```{r}
rep1$Dpi<-as.factor(rep1$Dpi)
```

## Viralload
##Calculate the ViralLoad using the regression equation derived by (Feng , J.L et al., 2006 ) and log transform for normality.

[Feng, J.L et al., 2006](https://academic.oup.com/abbs/article/38/10/669/217)

```{r}
rep1<-rep1 %>% 
mutate (ViralLoad=((10^((Cq-37.416)/-3.353)))) %>% ##added a new column and named ViralLoad
mutate(logViralLoad=log10(ViralLoad))  ##added a new column and named logViralLoad
```

##Classify the sample collection days based on leaf

```{r}
rep1$Leaf_sample<- ifelse(
  grepl("^IL", rep1$Dpi), "Inoculated",  # Matches Dpi values starting with IL
  ifelse(grepl("^SL", rep1$Dpi), "Systemic", NA)
)
```

##Data summarization

```{r}
CMV1 <- rep1 %>%  # Start with the dataset `rep1` and pipe (%>%) it into the next operations
  group_by(Dpi, Leaf_sample) %>%   # Group the data by treatment type and days post-inoculation (Dpi)
  dplyr::summarize(
    avg.virus= mean(logViralLoad, na.rm=TRUE),
    n=n(),
    se = sd(logViralLoad)/sqrt(n)) # join the significant letters with the PVY1 data frame.
```



```{r CMV 1st trial_NB_RNA3_1ng }
CMV_1 <- ggplot(CMV1,aes(x =factor(Dpi,levels=c("IL-1", "IL-4", "IL-7", "IL-10","SL-7", "SL-10")), y = avg.virus)) +
  stat_summary(fun=mean,geom="bar", position = position_dodge(width = 0.3), width = 0.4, fill="#56B4E9") +
   geom_errorbar(aes(ymin = avg.virus - se, 
                    ymax = avg.virus + se),
                width = 0.3,
                position = position_dodge(width = 0.3)) +
  labs(x = "Time Point (Dpi)", y = "Log Copy Number") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5),
        strip.text = element_text(face = "bold", size = 12, color = "black"),
        legend.position = "none", 
        axis.text.x = element_text(color = "black", face="bold", size=12),   # X-axis text color
        axis.text.y = element_text(color = "black", face="bold", size=12),   # Y-axis text color
        axis.title.x = element_text(color = "black", face="bold", size=15),  # X-axis label color
        axis.title.y = element_text(color = "black", face="bold", size=15),  # Y-axis label color
        axis.line = element_line(color = "black", size=0.75)      # Axis lines color
  ) +
  scale_y_continuous(
    expand = expansion(mult = c(0, 0.02)), breaks = seq(1, 9, by = 1)  # This removes padding at the bottom of the plot
  )+
   scale_x_discrete(drop = TRUE) +
  facet_grid(~Leaf_sample, scale="free_x", space="free_x")
 
  # Sets y-axis limits but removes points outside 0-8

CMV_1

```

# **Second trial**
## Load the data
```{r}
rep2 <- read.csv("Data-obj1-New/Nb_CMV_2nd_trial_New.csv", header=T)
head(rep2)  # View the first few rows
str(rep2)   # Check the structure of the data
summary(rep2) # Quick statistical summary
```

###Make the factor variable
```{r}
rep2$Dpi<-as.factor(rep2$Dpi)
```

## Viral load
##Calculate the ViralLoad using the regression equation derived by (Feng , J.L et al., 2006 ) and log transform for normality.

[Feng, J.L et al., 2006](https://academic.oup.com/abbs/article/38/10/669/217)

```{r}
rep2<-rep2 %>% 
mutate (ViralLoad=((10^((Cq-37.416)/-3.353)))) %>% ##added a new column and named ViralLoad
mutate(logViralLoad=log10(ViralLoad)) %>% 
  filter(Dpi!="SL-14")##added a new column and named logViralLoad
```

##Classify the sample collection days based on leaf

```{r}
rep2$Leaf_sample<-ifelse(
  grepl("^IL", rep2$Dpi), "Inoculated",  # Matches Dpi values starting with IL
  ifelse(grepl("^SL", rep2$Dpi), "Systemic", NA))
```

##Data summarization

```{r}
CMV2 <- rep2 %>%  # Start with the dataset `rep2` and pipe (%>%) it into the next operations
  group_by(Dpi, Leaf_sample) %>%   # Group the data by treatment type and days post-inoculation (Dpi)
  dplyr::summarize(
    avg.virus= mean(logViralLoad, na.rm=TRUE),
    n=n(),
    se = sd(logViralLoad)/sqrt(n)) # join the significant letters with the PVY1 data frame.
```

```{r CMV 2nd trial_NB_RNA3_1ng }
CMV_2 <- ggplot(CMV2,aes(x =factor(Dpi,levels=c("IL-1", "IL-4", "IL-7", "IL-10","SL-7", "SL-10")), y = avg.virus)) +
  stat_summary(fun=mean,geom="bar", position = position_dodge(width = 0.3), width = 0.4, fill="#56B4E9") +
   geom_errorbar(aes(ymin = avg.virus - se, 
                    ymax = avg.virus + se),
                width = 0.3,
                position = position_dodge(width = 0.3)) +
  labs(x = "Time Point (Dpi)", y = "Log Copy Number") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5),
        strip.text = element_text(face = "bold", size = 12, color = "black"),
        legend.position = "none", 
        axis.text.x = element_text(color = "black", face="bold", size=12),   # X-axis text color
        axis.text.y = element_text(color = "black", face="bold", size=12),   # Y-axis text color
        axis.title.x = element_text(color = "black", face="bold", size=15),  # X-axis label color
        axis.title.y = element_text(color = "black", face="bold", size=15),  # Y-axis label color
        axis.line = element_line(color = "black", size=0.75)      # Axis lines color
  ) +
  scale_y_continuous(
    expand = expansion(mult = c(0, 0.02)), breaks = seq(1, 9, by = 1)  # This removes padding at the bottom of the plot
  )+
   scale_x_discrete(drop = TRUE) +
  facet_grid(~Leaf_sample, scale="free_x", space="free_x")
 # Sets y-axis limits but removes points outside 0-8
# Sets y-axis limits but removes points outside 0-8

CMV_2

```

# **Supplementary First trial**

## Load the data
```{r}
rep1_RNA3_10ng <- read.csv("Data-obj1-New/Nb_CMV_1st_RNA3_10ng.csv", header=T)
head(rep1_RNA3_10ng)  # View the first few rows
str(rep1_RNA3_10ng)   # Check the structure of the data
summary(rep1_RNA3_10ng) # Quick statistical summary
```

###Make the factor variable
```{r}
rep1_RNA3_10ng$Dpi<-as.factor(rep1_RNA3_10ng$Dpi)
```
## Viral load
##Calculate the ViralLoad using the regression equation derived by (Feng , J.L et al., 2006 ) and log transform for normality.

[Feng, J.L et al., 2006](https://academic.oup.com/abbs/article/38/10/669/217)

```{r}
rep1_RNA3_10ng<-rep1_RNA3_10ng %>% 
mutate (ViralLoad=((10^((Cq-37.416)/-3.353)))) %>% ##added a new column and named ViralLoad
mutate(logViralLoad=log10(ViralLoad))  ##added a new column and named logViralLoad
```

##Classify the sample collection days based on leaf

```{r}
rep1_RNA3_10ng$Leaf_sample<- ifelse(
  grepl("^IL", rep1_RNA3_10ng$Dpi), "Inoculated",  # Matches Dpi values starting with IL
  ifelse(grepl("^SL", rep1_RNA3_10ng$Dpi), "Systemic", NA)
)
```

##Data summarization

```{r}
CMV1 <- rep1_RNA3_10ng %>%  # Start with the dataset `rep1` and pipe (%>%) it into the next operations
  group_by(Dpi, Leaf_sample) %>%   # Group the data by treatment type and days post-inoculation (Dpi)
  dplyr::summarize(
    avg.virus= mean(logViralLoad, na.rm=TRUE),
    n=n(),
    se = sd(logViralLoad)/sqrt(n)) # join the significant letters with the PVY1 data frame.
```

```{r CMV 1st trial_NB_RNA3_10ng }
CMV_1_RNA3_10ng <- ggplot(CMV1,aes(x =factor(Dpi,levels=c("IL-1", "IL-4", "IL-7", "IL-10","SL-7", "SL-10")), y = avg.virus)) +
  stat_summary(fun=mean,geom="bar", position = position_dodge(width = 0.3), width = 0.4, fill="#56B4E9") +
   geom_errorbar(aes(ymin = avg.virus - se, 
                    ymax = avg.virus + se),
                width = 0.3,
                position = position_dodge(width = 0.3)) +
  labs(x = "Time Point (Dpi)", y = "Log Copy Number") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5),
        strip.text = element_text(face = "bold", size = 12, color = "black"),
        legend.position = "none", 
        axis.text.x = element_text(color = "black", face="bold", size=12),   # X-axis text color
        axis.text.y = element_text(color = "black", face="bold", size=12),   # Y-axis text color
        axis.title.x = element_text(color = "black", face="bold", size=15),  # X-axis label color
        axis.title.y = element_text(color = "black", face="bold", size=15),  # Y-axis label color
        axis.line = element_line(color = "black", size=0.75)      # Axis lines color
  ) +
  scale_y_continuous(
    expand = expansion(mult = c(0, 0.02)), breaks = seq(1, 9, by = 1)  # This removes padding at the bottom of the plot
  )+
   scale_x_discrete(drop = TRUE) +
  facet_grid(~Leaf_sample, scale="free_x", space="free_x")
 # Sets y-axis limits but removes points outside 0-8

CMV_1_RNA3_10ng

```

## RNA3_NB
```{r, RNA3_Nb}
CMV_1_RNA3_10ng <- CMV_1_RNA3_10ng +
  labs(x = NULL, y = NULL) + # Remove axis labels
  theme(axis.title = element_blank()) # Remove axis titles

CMV_1 <- CMV_1 +
  labs(x = NULL, y = NULL) +
  theme(axis.title = element_blank())

CMV_2 <- CMV_2 +
  labs(x = NULL, y = NULL) +
  theme(axis.title = element_blank())
# Combine the three modified plots into one figure
combined_plot_RNA3 <- ggarrange(
  CMV_1_RNA3_10ng,
  CMV_1,
  CMV_2,
  ncol = 1,
  labels = c("A", "B", "C"), # Add labels A, B, C
  align = "v"      # vertically align plots
)

# Add shared axis titles
combined_plot_RNA3_annotated <- annotate_figure(
  combined_plot_RNA3,
  bottom = text_grob("Time Point (Dpi)", size = 15, face="bold"),
  left = text_grob("Log Copy Number", rot = 90, size = 15, face="bold")
)
combined_plot_RNA3_annotated
```


### Load the data
```{r}
rep1_CP_10ng <- read.csv("Data-obj1-New/Nb_CMV_1st_CP_10ng.csv", header=T)
head(rep1_CP_10ng)  # View the first few rows
str(rep1_CP_10ng)   # Check the structure of the data
summary(rep1_CP_10ng) # Quick statistical summary
```

###Make the factor variable
```{r}
rep1_CP_10ng$Dpi<-as.factor(rep1_CP_10ng$Dpi)
```
## Viral load
##Calculate the ViralLoad using the regression equation derived by (Feng , J.L et al., 2006 ) and log transform for normality.

[Feng, J.L et al., 2006](https://academic.oup.com/abbs/article/38/10/669/217)

```{r}
rep1_CP_10ng<-rep1_CP_10ng %>% 
mutate (ViralLoad=((10^((Cq-37.416)/-3.353)))) %>% ##added a new column and named ViralLoad
mutate(logViralLoad=log10(ViralLoad))  ##added a new column and named logViralLoad
```

##Classify the sample collection days based on leaf

```{r}
rep1_CP_10ng$Leaf_sample<- ifelse(
  grepl("^IL", rep1_CP_10ng$Dpi), "Inoculated",  # Matches Dpi values starting with IL
  ifelse(grepl("^SL", rep1_CP_10ng$Dpi), "Systemic", NA)
)
```

##Data summarization

```{r}
CMV1 <- rep1_CP_10ng %>%  # Start with the dataset `rep1` and pipe (%>%) it into the next operations
  group_by(Dpi, Leaf_sample) %>%   # Group the data by treatment type and days post-inoculation (Dpi)
  dplyr::summarize(
    avg.virus= mean(logViralLoad, na.rm=TRUE),
    n=n(),
    se = sd(logViralLoad)/sqrt(n)) # join the significant letters with the PVY1 data frame.
```



```{r CMV 1st trial_NB_CP_10ng }
CMV_1_CP_10ng <- ggplot(CMV1,aes(x =factor(Dpi,levels=c("IL-1", "IL-4", "IL-7", "IL-10","SL-7", "SL-10")), y = avg.virus)) +
  stat_summary(fun=mean,geom="bar", position = position_dodge(width = 0.3), width = 0.4, fill="#56B4E9") +
   geom_errorbar(aes(ymin = avg.virus - se, 
                    ymax = avg.virus + se),
                width = 0.3,
                position = position_dodge(width = 0.3)) +
  labs(x = "Time Point (Dpi)", y = "Log Copy Number") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5),
        strip.text = element_text(face = "bold", size = 12, color = "black"),
        legend.position = "none", 
        axis.text.x = element_text(color = "black", face="bold", size=12),   # X-axis text color
        axis.text.y = element_text(color = "black", face="bold", size=12),   # Y-axis text color
        axis.title.x = element_text(color = "black", face="bold", size=15),  # X-axis label color
        axis.title.y = element_text(color = "black", face="bold", size=15),  # Y-axis label color
        axis.line = element_line(color = "black", size=0.75)      # Axis lines color
  ) +
  scale_y_continuous(
    expand = expansion(mult = c(0, 0.02)), breaks = seq(1, 9, by = 1)  # This removes padding at the bottom of the plot
  )+
   scale_x_discrete(drop = TRUE) +
  facet_grid(~Leaf_sample, scale="free_x", space="free_x")# Sets y-axis limits but removes points outside 0-8

CMV_1_CP_10ng

```


## Load the data
```{r}
rep1_CP_1ng <- read.csv("Data-obj1-New/Nb_CMV_1st_CP_1ng.csv", header=T)
head(rep1_CP_1ng)  # View the first few rows
str(rep1_CP_1ng)   # Check the structure of the data
summary(rep1_CP_1ng) # Quick statistical summary
```

###Make the factor variable
```{r}
rep1_CP_1ng$Dpi<-as.factor(rep1_CP_1ng$Dpi)
```

## Viral Load
##Calculate the ViralLoad using the regression equation derived by (Feng , J.L et al., 2006 ) and log transform for normality.

[Feng, J.L et al., 2006](https://academic.oup.com/abbs/article/38/10/669/217)

```{r}
rep1_CP_1ng<-rep1_CP_1ng %>% 
mutate (ViralLoad=((10^((Cq-37.416)/-3.353)))) %>% ##added a new column and named ViralLoad
mutate(logViralLoad=log10(ViralLoad))  ##added a new column and named logViralLoad
```

##Classify the sample collection days based on leaf

```{r}
rep1_CP_1ng$Leaf_sample<- ifelse(
  grepl("^IL", rep1_CP_1ng$Dpi), "Inoculated",  # Matches Dpi values starting with IL
  ifelse(grepl("^SL", rep1_CP_1ng$Dpi), "Systemic", NA)
)
```

##Data summarization

```{r}
CMV1 <- rep1_CP_1ng %>%  # Start with the dataset `rep1` and pipe (%>%) it into the next operations
  group_by(Dpi, Leaf_sample) %>%   # Group the data by treatment type and days post-inoculation (Dpi)
  dplyr::summarize(
    avg.virus= mean(logViralLoad, na.rm=TRUE),
    n=n(),
    se = sd(logViralLoad)/sqrt(n)) # join the significant letters with the PVY1 data frame.
```



```{r CMV 1st trial_NB_CP_1ng }
CMV_1_CP_1ng <- ggplot(CMV1,aes(x =factor(Dpi,levels=c("IL-1", "IL-4", "IL-7", "IL-10","SL-7", "SL-10")), y = avg.virus)) +
  stat_summary(fun=mean,geom="bar", position = position_dodge(width = 0.3), width = 0.4, fill="#56B4E9") +
   geom_errorbar(aes(ymin = avg.virus - se, 
                    ymax = avg.virus + se),
                width = 0.3,
                position = position_dodge(width = 0.3)) +
  labs(x = "Time Point (Dpi)", y = "Log Copy Number") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5),
        strip.text = element_text(face = "bold", size = 12, color = "black"),
        legend.position = "none", 
        axis.text.x = element_text(color = "black", face="bold", size=12),   # X-axis text color
        axis.text.y = element_text(color = "black", face="bold", size=12),   # Y-axis text color
        axis.title.x = element_text(color = "black", face="bold", size=15),  # X-axis label color
        axis.title.y = element_text(color = "black", face="bold", size=15),  # Y-axis label color
        axis.line = element_line(color = "black", size=0.75)      # Axis lines color
  ) +
  scale_y_continuous(
    expand = expansion(mult = c(0, 0.02)), breaks = seq(1, 9, by = 1)  # This removes padding at the bottom of the plot
  )+
   scale_x_discrete(drop = TRUE) +
  facet_grid(~Leaf_sample, scale="free_x", space="free_x")# Sets y-axis limits but removes points outside 0-8

CMV_1_CP_1ng

```

# **Supplementary Second trial**
## Load the data
```{r}
rep2_CP_1ng <-read.csv("Data-obj1-New/Nb_CMV_2nd_CP_1ng.csv", header=T)
head(rep2_CP_1ng)  # View the first few rows
str(rep2_CP_1ng)   # Check the structure of the data
summary(rep2_CP_1ng) # Quick statistical summary
```

###Make the factor variable
```{r}
rep2_CP_1ng$Dpi<-as.factor(rep2_CP_1ng$Dpi)
```
## Viral load
##Calculate the ViralLoad using the regression equation derived by (Feng , J.L et al., 2006 ) and log transform for normality.

[Feng, J.L et al., 2006](https://academic.oup.com/abbs/article/38/10/669/217)

```{r}
rep2_CP_1ng<-rep2_CP_1ng %>% 
mutate (ViralLoad=((10^((Cq-37.416)/-3.353)))) %>% ##added a new column and named ViralLoad
mutate(logViralLoad=log10(ViralLoad)) %>% 
  filter(Dpi!="SL-14")##added a new column and named logViralLoad
```

##Classify the sample collection days based on leaf

```{r}
rep2_CP_1ng$Leaf_sample<- ifelse(
  grepl("^IL", rep2_CP_1ng$Dpi), "Inoculated",  # Matches Dpi values starting with IL
  ifelse(grepl("^SL", rep2_CP_1ng$Dpi), "Systemic", NA)
)
```

##Data summarization

```{r}
CMV2 <- rep2_CP_1ng %>%  # Start with the dataset `rep2_CP_1ng` and pipe (%>%) it into the next operations
  group_by(Dpi, Leaf_sample) %>%   # Group the data by treatment type and days post-inoculation (Dpi)
  dplyr::summarize(
    avg.virus= mean(logViralLoad, na.rm=TRUE),
    n=n(),
    se = sd(logViralLoad)/sqrt(n)) # join the significant letters with the PVY1 data frame.
```



```{r CMV 2nd trial_NB_CP_1ng}
CMV_2_CP_1ng <- ggplot(CMV2,aes(x =factor(Dpi,levels=c("IL-1", "IL-4", "IL-7", "IL-10","SL-7", "SL-10")), y = avg.virus)) +
  stat_summary(fun=mean,geom="bar", position = position_dodge(width = 0.3), width = 0.4, fill="#56B4E9") +
   geom_errorbar(aes(ymin = avg.virus - se, 
                    ymax = avg.virus + se),
                width = 0.3,
                position = position_dodge(width = 0.3)) +
  labs(x = "Time Point (Dpi)", y = "Log Copy Number") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5),
        strip.text = element_text(face = "bold", size = 12, color = "black"),
        legend.position = "none", 
        axis.text.x = element_text(color = "black", face="bold", size=12),   # X-axis text color
        axis.text.y = element_text(color = "black", face="bold", size=12),   # Y-axis text color
        axis.title.x = element_text(color = "black", face="bold", size=15),  # X-axis label color
        axis.title.y = element_text(color = "black", face="bold", size=15),  # Y-axis label color
        axis.line = element_line(color = "black", size=0.75)      # Axis lines color
  ) +
  scale_y_continuous(
    expand = expansion(mult = c(0, 0.02)), breaks = seq(1, 9, by = 1)  # This removes padding at the bottom of the plot
  )+
   scale_x_discrete(drop = TRUE) +
  facet_grid(~Leaf_sample, scale="free_x", space="free_x")# Sets y-axis limits but removes points outside 0-8

CMV_2_CP_1ng

```

## CP_Nb
```{r, CP_Nb}
# Remove axis titles
CMV_1_CP_10ng <- CMV_1_CP_10ng +
  labs(x = NULL, y = NULL) + # Remove x and y labels
  theme(axis.title = element_blank())

CMV_1_CP_1ng <- CMV_1_CP_1ng +
  labs(x = NULL, y = NULL) +
  theme(axis.title = element_blank())

CMV_2_CP_1ng <- CMV_2_CP_1ng +
  labs(x = NULL, y = NULL) +
  theme(axis.title = element_blank())
# Combine the three modified plots into one figure
combined_plot_CP <- ggarrange(
  CMV_1_CP_10ng,
  CMV_1_CP_1ng,
  CMV_2_CP_1ng,
  ncol = 1,
  labels = c("A", "B", "C"),
  align = "v"      # vertically align plots
)

# Add shared axis titles
combined_plot_CP_annotated <- annotate_figure(
  combined_plot_RNA3,
  bottom = text_grob("Time Point (Dpi)", size = 15, face="bold"),
  left = text_grob("Log Copy Number", rot = 90, size = 15, face="bold")
)
combined_plot_CP_annotated
```

